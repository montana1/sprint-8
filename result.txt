backend_1      | 172.31.0.1 - - [28/May/2025 11:53:12] "OPTIONS /reports HTTP/1.1" 200 -
backend_1      | 172.31.0.1 - - [28/May/2025 11:53:12] "GET /reports HTTP/1.1" 403 -
backend_1      | 172.31.0.1 - - [28/May/2025 11:53:19] "OPTIONS /reports HTTP/1.1" 200 -
backend_1      | [INFO] /reports: получен запрос
backend_1      | [INFO] Запрашиваем JWKS с URL: http://keycloak:8080/realms/reports-realm/protocol/openid-connect/certs
backend_1      | [INFO] Получены JWKS ключи: 2 ключей
backend_1      | [DEBUG] Заголовок Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJYMU5WOHFkNzVRblpSSXo1a1B0a0dvTFZ5c2xBZ0lNX3cxcmJfM0RYLVVNIn0.eyJleHAiOjE3NDg0MzM0NTAsImlhdCI6MTc0ODQzMzE1MCwiYXV0aF90aW1lIjoxNzQ4NDMzMTUwLCJqdGkiOiI2ZGNkODExNS0wN2VlLTRiMGMtOWY2My00OWZiYTBjMjFiNjAiLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvcmVhbG1zL3JlcG9ydHMtcmVhbG0iLCJzdWIiOiI0MGI5ZmQxZi05OTI2LTQ3ZWUtODA0OC0yZmI2YmZlNTRkZGUiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJyZXBvcnRzLWZyb250ZW5kIiwibm9uY2UiOiJjYzY0MzQzYy1jZjQ4LTQyZmEtYWFiOC0xNWIyODc1NDExMWIiLCJzZXNzaW9uX3N0YXRlIjoiZjYxZjYxMTEtMTI1MC00NWNhLTkyNDYtM2M2ZTMzY2M0NWYzIiwiYWNyIjoiMSIsImFsbG93ZWQtb3JpZ2lucyI6WyJodHRwOi8vbG9jYWxob3N0OjMwMDAiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbInByb3RoZXRpY191c2VyIl19LCJzY29wZSI6Im9wZW5pZCBwcm9maWxlIGVtYWlsIiwic2lkIjoiZjYxZjYxMTEtMTI1MC00NWNhLTkyNDYtM2M2ZTMzY2M0NWYzIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJuYW1lIjoiUHJvdGhldGljIFRocmVlIiwicHJlZmVycmVkX3VzZXJuYW1lIjoicHJvdGhldGljMyIsImdpdmVuX25hbWUiOiJQcm90aGV0aWMiLCJmYW1pbHlfbmFtZSI6IlRocmVlIiwiZW1haWwiOiJwcm90aGV0aWMzQGV4YW1wbGUuY29tIn0.lqd5_6WdMoK4JrlDoTh3Kloqaki7fLmhXNNGJsaybOdQ7BfR9QN8L3SzNVdVo_0sy-G1ezWF_BuBitXQAVQ5HGzbOcaFPDyCz14sJ-xQS_GmOlAt2hxOroqRhurUfSXayfY2NcJ-ECgyHbJtaR4PtV8eNwXxmR2T_bimpPIv1KycJFkemlaum-JgIa7JsXtRMk0O6c4EwzEi2SuKF0idas6PvESW1y1-5UzRGvzXChT9LX96IelNzcvH38_dG4h-dZQhta6MohWCgU8Ht04qAoa_0KPjQYQI4lXYn64xvyxMFBKdeYHvjAd9WMcJcetjFUkEzgozMHVuikzk03TI9A
backend_1      | [DEBUG] Извлечён токен: eyJhbGciOi... (обрезано)
backend_1      | [INFO] verify_token: начинаем валидацию токена
backend_1      | [DEBUG] get_public_key: получаем заголовок JWT
backend_1      | [DEBUG] Заголовок JWT: {'alg': 'RS256', 'typ': 'JWT', 'kid': 'X1NV8qd75QnZRIz5kPtkGoLVyslAgIM_w1rb_3DX-UM'}
backend_1      | [DEBUG] Ищем ключ с kid = X1NV8qd75QnZRIz5kPtkGoLVyslAgIM_w1rb_3DX-UM
backend_1      | [INFO] Найден подходящий публичный ключ
backend_1      | [INFO] Токен успешно проверен, claims: {'exp': 1748433450, 'iat': 1748433150, 'auth_time': 1748433150, 'jti': '6dcd8115-07ee-4b0c-9f63-49fba0c21b60', 'iss': 'http://localhost:8080/realms/reports-realm', 'sub': '40b9fd1f-9926-47ee-8048-2fb6bfe54dde', 'typ': 'Bearer', 'azp': 'reports-frontend', 'nonce': 'cc64343c-cf48-42fa-aab8-15b28754111b', 'session_state': 'f61f6111-1250-45ca-9246-3c6e33cc45f3', 'acr': '1', 'allowed-origins': ['http://localhost:3000'], 'realm_access': {'roles': ['prothetic_user']}, 'scope': 'openid profile email', 'sid': 'f61f6111-1250-45ca-9246-3c6e33cc45f3', 'email_verified': False, 'name': 'Prothetic Three', 'preferred_username': 'prothetic3', 'given_name': 'Prothetic', 'family_name': 'Three', 'email': 'prothetic3@example.com'}
backend_1      | [DEBUG] Роли пользователя: ['prothetic_user']
backend_1      | [INFO] Возвращаем данные: {'reportId': 8536, 'value': 0.7033539985991341, 'message': 'Random report data'}
backend_1      | [INFO] /reports: получен запрос
backend_1      | [INFO] Запрашиваем JWKS с URL: http://keycloak:8080/realms/reports-realm/protocol/openid-connect/certs
backend_1      | [INFO] Получены JWKS ключи: 2 ключей
backend_1      | [DEBUG] Заголовок Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJYMU5WOHFkNzVRblpSSXo1a1B0a0dvTFZ5c2xBZ0lNX3cxcmJfM0RYLVVNIn0.eyJleHAiOjE3NDg0MzM0ODgsImlhdCI6MTc0ODQzMzE4OCwiYXV0aF90aW1lIjoxNzQ4NDMzMTg4LCJqdGkiOiJjYzNjNGJiNS1lMTQ5LTQyZjItYWM3ZC05NDA0NDUwMzU2ZmIiLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvcmVhbG1zL3JlcG9ydHMtcmVhbG0iLCJzdWIiOiI0YWYwNjJkYS1jMmJlLTQ0NWMtOTU0MC1mYTI4MjQ0N2JkOGUiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJyZXBvcnRzLWZyb250ZW5kIiwibm9uY2UiOiIzOGVkMjI5Ny0wYjQ3LTRmYzgtOWZhOS1kMDA4MjUwMmJiNjciLCJzZXNzaW9uX3N0YXRlIjoiZDU1YjY0MGQtOTljOS00ZjI1LThlNGYtZDg3NTQ2NDI3ZGQ0IiwiYWNyIjoiMSIsImFsbG93ZWQtb3JpZ2lucyI6WyJodHRwOi8vbG9jYWxob3N0OjMwMDAiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbInVzZXIiXX0sInNjb3BlIjoib3BlbmlkIHByb2ZpbGUgZW1haWwiLCJzaWQiOiJkNTViNjQwZC05OWM5LTRmMjUtOGU0Zi1kODc1NDY0MjdkZDQiLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsIm5hbWUiOiJVc2VyIFR3byIsInByZWZlcnJlZF91c2VybmFtZSI6InVzZXIyIiwiZ2l2ZW5fbmFtZSI6IlVzZXIiLCJmYW1pbHlfbmFtZSI6IlR3byIsImVtYWlsIjoidXNlcjJAZXhhbXBsZS5jb20ifQ.AOl8pVIa8Jb74ozx-49VsEHudssIOu059f4IxfIthtx34d7HCOD634sj1Hprx8zi5xtD6wdPfZhcddMZscvenE9cAlfxqgojHjbjTetcKxN6lBDWiStN_gknstlrjWU65eQMYXtwVZo-qW2ouVBQuaYZEtiQytOKyDl-hoPyqoXa30HQhzAEjKa9kVo_VlLKqN23vDf8VbuehbP0ro2p6opJjRgjjQkAeYJrY_52LGjf0s4qoEXUuc9m8NZMmup5en7TJAE3D1QeRbcVANyMyGaaVLX_q6tMae1NXYdeYgx7Qh9jKvuWSMEu_Z9tL7wCOhnfthWBe9MAJu3SeMimPg
backend_1      | [DEBUG] Извлечён токен: eyJhbGciOi... (обрезано)
backend_1      | [INFO] verify_token: начинаем валидацию токена
backend_1      | [DEBUG] get_public_key: получаем заголовок JWT
backend_1      | [DEBUG] Заголовок JWT: {'alg': 'RS256', 'typ': 'JWT', 'kid': 'X1NV8qd75QnZRIz5kPtkGoLVyslAgIM_w1rb_3DX-UM'}
backend_1      | [DEBUG] Ищем ключ с kid = X1NV8qd75QnZRIz5kPtkGoLVyslAgIM_w1rb_3DX-UM
backend_1      | [INFO] Найден подходящий публичный ключ
backend_1      | [INFO] Токен успешно проверен, claims: {'exp': 1748433488, 'iat': 1748433188, 'auth_time': 1748433188, 'jti': 'cc3c4bb5-e149-42f2-ac7d-9404450356fb', 'iss': 'http://localhost:8080/realms/reports-realm', 'sub': '4af062da-c2be-445c-9540-fa282447bd8e', 'typ': 'Bearer', 'azp': 'reports-frontend', 'nonce': '38ed2297-0b47-4fc8-9fa9-d0082502bb67', 'session_state': 'd55b640d-99c9-4f25-8e4f-d87546427dd4', 'acr': '1', 'allowed-origins': ['http://localhost:3000'], 'realm_access': {'roles': ['user']}, 'scope': 'openid profile email', 'sid': 'd55b640d-99c9-4f25-8e4f-d87546427dd4', 'email_verified': False, 'name': 'User Two', 'preferred_username': 'user2', 'given_name': 'User', 'family_name': 'Two', 'email': 'user2@example.com'}
backend_1      | [DEBUG] Роли пользователя: ['user']
backend_1      | [WARN] Роль 'prothetic_user' отсутствует, доступ запрещён
backend_1      | [INFO] /reports: получен запрос
backend_1      | [INFO] Запрашиваем JWKS с URL: http://keycloak:8080/realms/reports-realm/protocol/openid-connect/certs
backend_1      | [INFO] Получены JWKS ключи: 2 ключей
backend_1      | [DEBUG] Заголовок Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJYMU5WOHFkNzVRblpSSXo1a1B0a0dvTFZ5c2xBZ0lNX3cxcmJfM0RYLVVNIn0.eyJleHAiOjE3NDg0MzM0ODgsImlhdCI6MTc0ODQzMzE4OCwiYXV0aF90aW1lIjoxNzQ4NDMzMTg4LCJqdGkiOiJjYzNjNGJiNS1lMTQ5LTQyZjItYWM3ZC05NDA0NDUwMzU2ZmIiLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvcmVhbG1zL3JlcG9ydHMtcmVhbG0iLCJzdWIiOiI0YWYwNjJkYS1jMmJlLTQ0NWMtOTU0MC1mYTI4MjQ0N2JkOGUiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJyZXBvcnRzLWZyb250ZW5kIiwibm9uY2UiOiIzOGVkMjI5Ny0wYjQ3LTRmYzgtOWZhOS1kMDA4MjUwMmJiNjciLCJzZXNzaW9uX3N0YXRlIjoiZDU1YjY0MGQtOTljOS00ZjI1LThlNGYtZDg3NTQ2NDI3ZGQ0IiwiYWNyIjoiMSIsImFsbG93ZWQtb3JpZ2lucyI6WyJodHRwOi8vbG9jYWxob3N0OjMwMDAiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbInVzZXIiXX0sInNjb3BlIjoib3BlbmlkIHByb2ZpbGUgZW1haWwiLCJzaWQiOiJkNTViNjQwZC05OWM5LTRmMjUtOGU0Zi1kODc1NDY0MjdkZDQiLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsIm5hbWUiOiJVc2VyIFR3byIsInByZWZlcnJlZF91c2VybmFtZSI6InVzZXIyIiwiZ2l2ZW5fbmFtZSI6IlVzZXIiLCJmYW1pbHlfbmFtZSI6IlR3byIsImVtYWlsIjoidXNlcjJAZXhhbXBsZS5jb20ifQ.AOl8pVIa8Jb74ozx-49VsEHudssIOu059f4IxfIthtx34d7HCOD634sj1Hprx8zi5xtD6wdPfZhcddMZscvenE9cAlfxqgojHjbjTetcKxN6lBDWiStN_gknstlrjWU65eQMYXtwVZo-qW2ouVBQuaYZEtiQytOKyDl-hoPyqoXa30HQhzAEjKa9kVo_VlLKqN23vDf8VbuehbP0ro2p6opJjRgjjQkAeYJrY_52LGjf0s4qoEXUuc9m8NZMmup5en7TJAE3D1QeRbcVANyMyGaaVLX_q6tMae1NXYdeYgx7Qh9jKvuWSMEu_Z9tL7wCOhnfthWBe9MAJu3SeMimPg
backend_1      | [DEBUG] Извлечён токен: eyJhbGciOi... (обрезано)
backend_1      | [INFO] verify_token: начинаем валидацию токена
backend_1      | [DEBUG] get_public_key: получаем заголовок JWT
backend_1      | [DEBUG] Заголовок JWT: {'alg': 'RS256', 'typ': 'JWT', 'kid': 'X1NV8qd75QnZRIz5kPtkGoLVyslAgIM_w1rb_3DX-UM'}
backend_1      | [DEBUG] Ищем ключ с kid = X1NV8qd75QnZRIz5kPtkGoLVyslAgIM_w1rb_3DX-UM
backend_1      | [INFO] Найден подходящий публичный ключ
backend_1      | [INFO] Токен успешно проверен, claims: {'exp': 1748433488, 'iat': 1748433188, 'auth_time': 1748433188, 'jti': 'cc3c4bb5-e149-42f2-ac7d-9404450356fb', 'iss': 'http://localhost:8080/realms/reports-realm', 'sub': '4af062da-c2be-445c-9540-fa282447bd8e', 'typ': 'Bearer', 'azp': 'reports-frontend', 'nonce': '38ed2297-0b47-4fc8-9fa9-d0082502bb67', 'session_state': 'd55b640d-99c9-4f25-8e4f-d87546427dd4', 'acr': '1', 'allowed-origins': ['http://localhost:3000'], 'realm_access': {'roles': ['user']}, 'scope': 'openid profile email', 'sid': 'd55b640d-99c9-4f25-8e4f-d87546427dd4', 'email_verified': False, 'name': 'User Two', 'preferred_username': 'user2', 'given_name': 'User', 'family_name': 'Two', 'email': 'user2@example.com'}172.31.0.1 - - [28/May/2025 11:53:19] "GET /reports HTTP/1.1" 403 -
